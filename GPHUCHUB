-- üß† GPhuc Hub GUI v5 + Aimbot (thay Laser Cape Fire)
-- ƒê·∫∑t v√†o StarterPlayer > StarterPlayerScripts

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")
local HttpService = game:GetService("HttpService")
local TS = game:GetService("TeleportService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- üñºÔ∏è H√¨nh b·∫≠t menu
local ImageId = "rbxassetid://93615431235244"

-- üìú GUI ch√≠nh
local gui = Instance.new("ScreenGui")
gui.Name = "GPhucHub_GUI"
gui.ResetOnSpawn = false
gui.Parent = PlayerGui

-- üîò N√∫t m·ªü menu
local toggleButton = Instance.new("ImageButton")
toggleButton.Name = "ToggleButton"
toggleButton.Parent = gui
toggleButton.Size = UDim2.new(0, 40, 0, 40)
toggleButton.Position = UDim2.new(0.5, -20, 0.5, -20)
toggleButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
toggleButton.Image = ImageId
toggleButton.Draggable = true
toggleButton.BorderSizePixel = 0

-- üß± Menu ch√≠nh
local menu = Instance.new("Frame")
menu.Parent = gui
menu.Size = UDim2.new(0, 220, 0, 260)
menu.Position = UDim2.new(0.5, -110, 0.5, -130)
menu.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
menu.BackgroundTransparency = 0.5
menu.Visible = false
menu.BorderSizePixel = 0

-- üßæ Ti√™u ƒë·ªÅ
local title = Instance.new("TextLabel")
title.Parent = menu
title.Size = UDim2.new(1, 0, 0, 35)
title.BackgroundTransparency = 1
title.Text = "üß† GPhuc Hub"
title.Font = Enum.Font.FredokaOne
title.TextSize = 20
title.TextColor3 = Color3.fromRGB(255, 255, 255)

-- ‚öôÔ∏è Bi·∫øn tr·∫°ng th√°i
local jE, gE, eE, kE, aE = false, false, false, false, false -- aE = Aimbot enabled
local jumpPower = 75

-- ‚öôÔ∏è H√†m t·∫°o n√∫t ON/OFF
local function createToggleButton(text, order, callback)
	local btn = Instance.new("TextButton")
	btn.Parent = menu
	btn.Size = UDim2.new(0.9, 0, 0, 30)
	btn.Position = UDim2.new(0.05, 0, 0, 40 + (order - 1) * 35)
	btn.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
	btn.TextColor3 = Color3.fromRGB(255, 255, 255)
	btn.Font = Enum.Font.SourceSansBold
	btn.TextSize = 18
	btn.Text = text .. ": OFF"
	btn.BorderSizePixel = 0

	local state = false
	btn.MouseButton1Click:Connect(function()
		state = not state
		btn.Text = text .. ": " .. (state and "ON" or "OFF")
		callback(state)
	end)
end

-- ‚ö° Jump Height
createToggleButton("Jump Height", 1, function(state)
	jE = state
	local char = player.Character or player.CharacterAdded:Wait()
	local hum = char:WaitForChild("Humanoid")
	hum.UseJumpPower = true
	hum.JumpPower = state and jumpPower or 50
end)

-- üå™Ô∏è Gravity (r∆°i ch·∫≠m)
createToggleButton("Gravity", 2, function(state)
	gE = state
end)

-- üëÅÔ∏è ESP
createToggleButton("ESP", 3, function(state)
	eE = state
	for _, p in pairs(Players:GetPlayers()) do
		if p ~= player then
			local ch = p.Character
			if ch then
				local esp = ch:FindFirstChild("GPhucESP")
				if not esp and state then
					local hl = Instance.new("Highlight", ch)
					hl.Name = "GPhucESP"
					hl.FillTransparency = 0.5
					hl.OutlineTransparency = 0
					hl.FillColor = Color3.fromRGB(0, 255, 0)
				elseif esp and not state then
					esp:Destroy()
				end
			end
		end
	end
end)

-- üß® Auto Kick
createToggleButton("Auto Kick", 4, function(state)
	kE = state
end)

-- üéØ Aimbot (thay Laser Cape Fire)
createToggleButton("Aimbot", 5, function(state)
	aE = state
end)

--// Aimbot config
local fixedPosition = Vector3.new(-460.03, -6.10, -2.12) -- v·ªã tr√≠ g·ª≠i l√™n remote (gi·ªØ nguy√™n)
local maxDistance = 100 -- ph·∫°m vi t√¨m target (studs)
local fireRate = 0.3 -- gi√¢y gi·ªØa c√°c l·∫ßn fire
local Remote = nil
do
	local ok, val = pcall(function()
		return ReplicatedStorage:WaitForChild("Packages"):WaitForChild("Net"):WaitForChild("RE/UseItem")
	end)
	if ok then Remote = val end
end

--// Utility: get closest valid player (returns player or nil)
local function getClosestPlayer()
	local char = player.Character
	if not char or not char:FindFirstChild("HumanoidRootPart") then return nil end
	local root = char.HumanoidRootPart
	local closest, closestDist = nil, math.huge
	for _, p in pairs(Players:GetPlayers()) do
		if p ~= player and p.Character and p.Character:FindFirstChild("HumanoidRootPart") and p.Character:FindFirstChild("UpperTorso") then
			local pos = p.Character.HumanoidRootPart.Position
			local dist = (root.Position - pos).Magnitude
			if dist <= maxDistance and dist < closestDist then
				closest = p
				closestDist = dist
			end
		end
	end
	return closest
end

--// Fire remote at a specific player's UpperTorso (if valid)
local function fireAtPlayer(targetPlayer)
	if not Remote then return end
	if not targetPlayer or not targetPlayer.Character then return end
	local ut = targetPlayer.Character:FindFirstChild("UpperTorso")
	if not ut then return end
	-- g·ª≠i v·ªã tr√≠ c·ªë ƒë·ªãnh v√† UpperTorso (gi·ªØ format remote ban ƒë·∫ßu)
	pcall(function()
		Remote:FireServer(fixedPosition, ut)
	end)
end

--// Tool listener & firing loop (respects aimbot toggle aE)
local function setupToolListener(char)
	local firing = false
	local tool = nil
	local fireThread = nil

	local function startFiringLoop()
		if fireThread then return end
		fireThread = task.spawn(function()
			while firing do
				-- ch·ªâ b·∫Øn khi Aimbot b·∫≠t
				if aE then
					local target = getClosestPlayer()
					if target then
						fireAtPlayer(target)
					end
				end
				task.wait(fireRate)
			end
			fireThread = nil
		end)
	end

	char.ChildAdded:Connect(function(child)
		if child:IsA("Tool") and child.Name == "Laser Cape" then
			tool = child
			firing = true
			startFiringLoop()
		end
	end)

	char.ChildRemoved:Connect(function(child)
		if child == tool then
			firing = false
			tool = nil
		end
	end)

	for _, child in pairs(char:GetChildren()) do
		if child:IsA("Tool") and child.Name == "Laser Cape" then
			tool = child
			firing = true
			startFiringLoop()
		end
	end

	-- N·∫øu toggle Aimbot t·∫Øt/b·∫≠t trong l√∫c ƒëang c·∫ßm tool, loop v·∫´n ch·∫°y nh∆∞ng ch·ªâ fire khi aE == true
end

--// Handle current character & respawn
if player.Character then setupToolListener(player.Character) end
player.CharacterAdded:Connect(function(char)
	task.wait(1)
	setupToolListener(char)
end)

-- ‚öôÔ∏è Gravity x·ª≠ l√Ω
RunService.Stepped:Connect(function()
	if gE then
		local char = player.Character
		if char and char:FindFirstChild("HumanoidRootPart") then
			local root = char.HumanoidRootPart
			local hum = char:FindFirstChildOfClass("Humanoid")
			if hum and hum:GetState() == Enum.HumanoidStateType.Freefall then
				root.Velocity = Vector3.new(root.Velocity.X, math.max(root.Velocity.Y, -15), root.Velocity.Z)
			end
		end
	end
end)

-- üö® T·ª± ƒë·ªông Kick khi c√≥ ch·ªØ ‚ÄúYou stole‚Äù xu·∫•t hi·ªán
RunService.RenderStepped:Connect(function()
	if kE then
		for _, guiObj in pairs(PlayerGui:GetDescendants()) do
			if guiObj:IsA("TextLabel") or guiObj:IsA("TextButton") then
				local text = tostring(guiObj.Text):lower()
				if text:find("you stole") then
					player:Kick("üíÄ You kicked by GPhuc")
				end
			end
		end
	end
end)

-- üü° Toggle menu
toggleButton.MouseButton1Click:Connect(function()
	menu.Visible = not menu.Visible
end)

print("‚úÖ GPhuc Hub v5 + Aimbot ƒë√£ kh·ªüi ƒë·ªông")
